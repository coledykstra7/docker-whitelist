# Blacklist ACL
acl blacklist dstdomain "/data/blacklist.txt"

# Deny blacklist before allowing whitelist
http_access deny blacklist
# Performance tuning
workers 4
max_filedescriptors 65536
pipeline_prefetch on
forward_max_tries 20
# Use fast public DNS servers
dns_nameservers 8.8.8.8 1.1.1.1
# Squid whitelist proxy config
http_port 3128

# Whitelist ACL
acl whitelist dstdomain "/data/whitelist.txt"

# Simplified, parse-friendly log format:
# ts.millis client-ip METHOD URL STATUS
logformat simple %ts.%03tu %>a %rm %>Hs %>rd %ru
#
# Split logs by ACL category
access_log stdio:/data/access-whitelist.log simple whitelist
access_log stdio:/data/access-blacklist.log simple blacklist
access_log stdio:/data/access-regular.log simple !whitelist !blacklist
acl SSL_ports port 443
acl Safe_ports port 80 443
acl CONNECT method CONNECT


# Allow HTTP and HTTPS (CONNECT) only to whitelisted domains
http_access allow whitelist
http_access allow CONNECT whitelist SSL_ports
deny_info ERR_HTTP_NOT_FOUND all
http_access deny all

# Prevent caching
cache deny all
